# Kernel Exploits
The page [Windows Kernel Exploits](https://pentestlab.blog/2017/04/24/windows-kernel-exploits/) contains a table where one can look for missing patched or hotfixes.

**IMPORTANT REFERENCES**:
* [OS, bulletin and exploit table](https://pentestlab.blog/2017/04/24/windows-kernel-exploits/)
* [List of exploits](http://www.bhafsec.com/wiki/index.php/Windows_Privilege_Escalation)
* [AusJock/Privilege-Escalation](https://github.com/AusJock/Privilege-Escalation/tree/master/Windows)  
* [Windows exploits, mostly precompiled (not being updated)](https://github.com/abatchy17/WindowsExploits)
* [Great source for source & precompiled](https://github.com/SecWiki/windows-kernel-exploits)
* https://github.com/offensive-security/exploitdb-bin-sploits/tree/master/bin-sploits

## Tools identifying exploits that can be used

1. GDSSecurity - **Windows Exploit Suggester**    
  "This tool compares a targets patch levels against the Microsoft vulnerability database in order to detect potential missing patches on the target. It also notifies the user if there are public exploits and Metasploit modules available for the missing bulletins."  
  It requires the 'systeminfo' command output from a Windows host in order to compare that the Microsoft security bulletin database and determine the patch level of the host.
  https://github.com/GDSSecurity/Windows-Exploit-Suggester
  ```
  $ ./windows-exploit-suggester.py --update
  ...
  $ ./windows-exploit-suggester.py --database 2014-06-06-mssb.xlsx --systeminfo win7sp1-systeminfo.txt

  # python windows-exploit-suggester.py --database 2019-01-09-mssb.xls --systeminfo ~/tools/tmp/systeminfo.txt --ostext "windows 7 sp1"
  ...
  ```

4. Sherlock - PowerShell
  https://github.com/rasta-mouse/Sherlock
  PowerShell script to quickly find missing software patches for local privilege escalation vulnerabilities.

* .Net - Watson
  https://github.com/rasta-mouse/Watson




## Manually find exploits that can be used

* Exploit-DB: Google
  ```
  site:exploit-db.com privilege escalation windows 7
  ```

* List of Vulnerabilities can be found [here](https://github.com/SecWiki/windows-kernel-exploits) and [here](http://www.bhafsec.com/wiki/index.php/Windows_Privilege_Escalation)

* Identify hotfixes / patches
  ```
  systeminfo

  OR

  wmic qfe get Caption,Description,HotFixID,InstalledOn
  ```

* Using Metasploit
  ```
  post/windows/gather/enum_patches
  ```

After enumerating the OS version and Service Pack you should find out which privilege escalation vulnerabilities could be present. Using the KB patch numbers you can grep the installed patches to see if any are missing

## Other Exploits

* KiTrap0D  
http://lock.cmpxchg8b.com/c0af0967d904cef2ad4db766a00bc6af/KiTrap0D.zip

* **Tomcat** Windows privilege escalation  
  https://www.exploit-db.com/exploits/7264/

* **NtGdiEnableEudc** Exploit (**MS11-011**) - windows XP SP0-3  
  16262,platforms/windows/dos/16262.,"MS11-011(CVE-2011-0045): MS Windows XP WmiTraceMessageVa Integer Truncation Vulnerability PoC",2011-03-01,"Nikita Tarakanov",windows,dos,0   
  http://www.securityfocus.com/bid/46136/exploit  
  http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-0045  
  http://downloads.securityfocus.com/vulnerabilities/exploits/46136.c  
  http://cissrt.blogspot.com/2011/02/cve-2011-0045-ms-windows-xp.html  
  http://www.microsoft.com/technet/security/Bulletin/MS11-011.mspx  

* **Service Tracing Key (MS10-059)**  
The Tracing Feature for Services in Microsoft Windows Vista SP1 and SP2, Windows Server 2008 Gold, SP2, and R2, and Windows 7 has incorrect ACLs on its registry keys, which allows local users to gain privileges via vectors involving a named pipe and impersonation, aka "Tracing Registry Key ACL Vulnerability."   

  http://www.securityfocus.com/bid/42269/exploit  
  https://www.exploit-db.com/exploits/14610/
  http://www.securityfocus.com/data/vulnerabilities/exploits/Chimichurri.zip  
  https://www.cvedetails.com/cve/CVE-2010-2554/  

* **Registry Symlink Vuln (MS10-021)**  
This vulnerability was verified by the authors on the following platforms:  
Windows NT 3.1/3.5  
Windows NT4 SP1  
Windows Server 2003 SP2  
Windows XP SP3  
Windows Vista x32  
Windows 7 x32 RC  
However, all versions of Windows implementing NTLM v1 and v2 are suspected to be affected.
  https://www.exploit-db.com/exploits/15266/  

* Ryujin - **ADF.sys priv esc - ms11-080**  
afd.sys in the Ancillary Function Driver in Microsoft Windows XP SP2 and SP3 and Server 2003 SP2 does not properly validate user-mode input passed to kernel mode, which allows local users to gain privileges via a crafted application, aka "Ancillary Function Driver Elevation of Privilege Vulnerability."   

  http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-2005  
  http://www.exploit-db.com/exploits/18176  
  pyinstaller - http://www.pyinstaller.org/  
  py2exe - http://www.py2exe.org/  

* **UAC Bypass priv esc**  
Stack-based buffer overflow in the RtlQueryRegistryValues function in win32k.sys in Microsoft Windows XP SP2 and SP3, Windows Server 2003 SP2, Windows Vista SP1 and SP2, Windows Server 2008 Gold, SP2, and R2, and Windows 7 allows local users to gain privileges, and bypass the User Account Control (UAC) feature, via a crafted REG_BINARY value for a SystemDefaultEUDCFont registry key, aka "Driver Improper Interaction with Windows Kernel Vulnerability."   

  http://www.exploit-db.com/exploits/15609  
  http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-4398  
  http://www.securityfocus.com/bid/45045/info  
  https://www.securityfocus.com/data/vulnerabilities/exploits/45045.zip


## SMB Related
- MS08-067
- MS09-050
- MS10-061
- MS17-010

* MS17-010 https://github.com/3ndG4me/AutoBlue-MS17-010

* **WannaCry - MS17-101**  
  - RCE using SMBv1  
  - Test for with https://github.com/vletoux/ms17-010-Scanner  
  - OR via nmap script: `nmap -Pn -oA results -p445 --script smb-vuln-ms2017-010 `

  - https://github.com/worawit/MS17-010
